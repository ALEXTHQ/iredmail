{% extends "layout.html" %}

{% from "macros.html" import set_account_status_img %}

{% block title %}{{ _('Domain admins') }}{% endblock %}

{% block jquery_snippets %}
{# Sort user name at initialization. #}
$("#admin_list").tablesorter( {
    headers: {4: {sorter: false},},
    sortList: [[1,0]]
});
{% endblock jquery_snippets %}

{#
{% block leftcolumn %}
<div class="note">
<h4>{{ _('Search admin') }}</h4>
<form method="post" action="{{ctx.homepath}}/search">
    <input type="hidden" name="searchType" value="admin">
    <input type="text" name="admin" value="" size="13">
    <input type="submit" value="{{ _('Search') }}" class="button">
</form>
</div>
#}

    {# Display input field for adding new domain. #}
    {#
    {% if session.get('domainGlobalAdmin') == 'yes' %}
        <div class="note">
        <form method="post" action="{{ctx.homepath}}/admin/list">
            <input type="hidden" name="action" value="add" />

            <table>
                <h4>{{ _('Add a new admin:') }}</h4>
                <tr><td>{{ _('E-Mail:') }}</th><td><input type="text" name="admin" value="" size="13" /></td></tr>
                <tr><td>{{ _('Password:') }}</th><td><input type="password" name="passwd" value="" size="13" /></td></tr>
                <tr><td colspan="2"><input type="checkbox" name="domainGlobalAdmin" value="yes" /> {{ _('As Global Admin') }} <input type="submit" value="{{ _('Add now') }}" class="button"/></td>
            </table>

            <p>{{ _('Note:') }}
                <ul>
                    <li>{{ _('Do <strong>NOT</strong> specify multiple accounts.') }}</li>
                </ul>
            </p>
        </form>
        </div>
    {% endif %}
{% endblock %}
#}

{% block main %}
<div id="brd-crumbs-top" class="crumbs gen-content">
    <p><span class="crumblast">{{ _('All mail administrators.') }} {{ _('Total: %s.') |format(admins |length) }}</span></p>
</div>

{# Show system message #}
{#
{% if msg is defined %}
    <div class="note">
        <h5>{{ _('System message:') }}</h5>

        <ul>
        {% for i in msg.items() %}
            <li>{{ i[1] }} ({{i[0]}})</li>
        {% endfor %}
        </ul>
    </div>
{% endif %}
#}

{# List admins #}

{#{% if admins|length > 0 %}#}
{% if admins is not string %}
    <div>
    <form name="list_table" id="list_table" action="{{ctx.homepath}}/admin/list" method="post">
        <input type="hidden" name="action" value="delete" />

        <table id="admin_list" class="full tablesorter headerSortUp">
        <thead>
        <tr>
            <th><input type="checkbox" name="checkall" id="checkall" />{{ _('Name') }}</th>
            <th>{{ _('Mail') }}</th>
            <th>{{ _('Global Admin') }}</th>
        </tr>
        </thead>

        <tbody>
        {% for admin in admins %}
            {% set dn = admin[0] %}
            {% set entry = admin[1] %}

            {% set mail = entry.get('mail')[0] %}
            {% set cn = entry.get('cn', [''])[0].decode('utf-8') %}
            {% set accountStatus = entry.get('accountStatus', ['disabled'])[0] %}
            {% set domainGlobalAdmin = entry.get('domainGlobalAdmin', ['no'])[0] %}

            <tr class="{{ loop.cycle('odd', 'even') }} {{ accountStatus |lower }}">
                <td>
                    <span class="float_left">
                        <input type="checkbox" name="dn" value="{{dn}}" />
                        <a href="{{ctx.homepath}}/profile/admin/{{mail}}" title="{{ _('Edit admin profile.') }}">{{ cn }}</a>
                    </span>
                    <span class="float_right">{{ set_account_status_img(accountStatus) }}</span>
                </td>
                <td><a href="mailto:{{mail}}" title="{{ _('Send mail to %s.') |format(mail) }}">{{ mail }}</a></td>
                <td>{{ set_account_status_img(domainGlobalAdmin) }}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

        <div class="frm-buttons">
            <span class="submit">
                <input type="checkbox" name="checkall" id="checkall" />{{ _('Select all') }}
                <input type="submit" name="save" value="{{ _('Delete') }}" onclick="return confirm('{{ _('Are you sure want to delete selected account(s)?') }}');" }}" />
            </span>
        </div>
    </form>
</div>
{% endif %}

{% endblock main %}
