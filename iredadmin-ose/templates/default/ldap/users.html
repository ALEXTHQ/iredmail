{% extends "layout.html" %}

{% from "macros.html" import set_account_status_img %}
{% from "submenus.html" import submenu_domains %}

{% block title %}{{ _('Mail users') }}{% endblock %}

{% block jquery_snippets %}
{# Sort user name at initialization. #}
$("#user_list").tablesorter( {
    sortList: [[1,0]]
});
{% endblock jquery_snippets %}

{% block main %}
{# Sub-menu #}
{{ submenu_domains(homepath=ctx.homepath,domain=domain, active='users') }}

{# Show system message #}
{#
{% if msg is defined and msg is not none %}
    <div class="note">
        <p>{{ _('System message:') }}</p>

        <ul>
        {% if msg == 'PERMISSION_DENIED' %}
            <p>{{ _('Permission deny.') }}</p>
        {% elif msg == 'SIZELIMIT_EXCEEDED' %}
            <p>{{ _('Size limit exceeded.') }}</p>
        {% elif msg == 'ADDED_SUCCESS' %}
            <p>{{ _('Added success.') }}</p>
        {% else %}
            <p>{{ msg }}</p>
        {% endif %}
        </ul>
    </div>
{% endif %}
#}

{# List all users. #}
<div> {# id="main-content" class="main-pagepost gen-content">#}
<form name="list_table" id="list_table" action="{{ctx.homepath}}/delete/user" method="post">
<input type="hidden" name="domain" value="{{ domain }}" />
<table id="user_list" class="full tablesorter headerSortUp">
    {# Table header. #}
    <thead>
    <tr>
        <th>
            <input type="checkbox" name="checkall" id="checkall" />
            {{ _('Name') }}/{{ users |length}}
        </th>
        <th>{{ _('Mail') }}</th>
        <th>{{ _('Mail Quota') }}</th>
        <th>{{ _('Created Date') }}</th>
    </tr>
    </thead>

    {# List user attributes/avalues. #}
    <tbody>
    {% if users is not string or users |length != 0 %}
        {% for i in users %}
            {% set entries = i[1] %}
            {#{% set cn = entries.get('cn', [''])[0].decode('utf-8') %}#}
            {% set mail = entries.get('mail')[0] |string %}
            {# If not present, mark as 'disabled'. #}
            {% set accountStatus = entries.get('accountStatus', ['disabled'])[0] %} 
            {% set createTimestamp = entries.get('createTimestamp', ['--------------'])[0] %}

            <tr class="{{ loop.cycle('odd', 'even') }} {{ accountStatus |lower }}">
                <td>
                    <span class="float_left">
                        <a href="{{ctx.homepath}}/profile/user/{{mail}}" title="{{ _('Edit user profile.') }}">{{ entries.get('cn', [''])[0].decode('utf-8') }}</a>
                    </span>
                    <span class="float_right">{{ set_account_status_img(accountStatus) }}</span>
                </td>
                <td><a href="mailto:{{mail}}" title="{{ _('Send mail to %s.') |format(mail) }}">{{ mail }}</a></td>

            {# mail quota #}
            <td>{{ entries.get('mailQuota', [0])[0] |filesizeformat }}</td>

            <td>{{createTimestamp[:4]}}-{{createTimestamp[4:6]}}-{{createTimestamp[6:8]}} {{createTimestamp[8:10]}}:{{createTimestamp[10:12]}}:{{createTimestamp[12:14]}}</td>
        </tr>
    {% endfor %}
    </tbody>
</table>

    <div class="frm-buttons">
        <span class="submit">
            <input type="checkbox" name="checkall" id="checkall" />{{ _('Select all') }}
            <input type="submit" name="save" value="{{ _('Delete') }}" onclick="return confirm('{{ _('Are you sure want to delete selected group(s)?') }}');" }}" />
        </span>
    </div>
    {%endif%}
</form>
</div>
{% endblock main %}
