<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>6.3. &#37197;&#32622; OpenLDAP</title><link rel="stylesheet" href="docbook.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.69.1"><link rel="start" href="index.html" title="Mail Server Solution for OpenBSD"><link rel="up" href="openldap.html" title="Chapter 6. OpenLDAP"><link rel="prev" href="openldap_installation.html" title="6.2. &#23433;&#35013; OpenLDAP"><link rel="next" href="openldap_rc_conf_local.html" title="6.4. /etc/rc.conf.local"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">6.3. &#37197;&#32622; OpenLDAP</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="openldap_installation.html">Prev</a> </td><th width="60%" align="center">Chapter 6. OpenLDAP</th><td width="20%" align="right"> <a accesskey="n" href="openldap_rc_conf_local.html">Next</a></td></tr></table><hr></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="openldap_configuration"></a>6.3. &#37197;&#32622; OpenLDAP</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="openldap_qmail_schema"></a>6.3.1. qmail.schema</h3></div></div></div><p>
                &#36825;&#37324;&#23558;&#20351;&#29992; qmail.schema &#29992;&#20110;&#19982; Postfix &#30340;&#25972;&#21512;&#12290;&#21487;&#20197;&#20174; <a href="samples/qmail.schema" target="_top">&#36825;&#37324;</a> &#19979;&#36733;&#21518;&#22797;&#21046;&#21040;&#23545;&#24212;&#30340;&#30446;&#24405;&#65306;
</p><pre class="programlisting">
# cp qmail.schema /etc/openldap/schema/
</pre><p>
            </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="openldap_slapd_conf"></a>6.3.2. /etc/openldap/slapd.conf</h3></div></div></div><p>
                OpenLDAP &#30340;&#20027;&#37197;&#32622;&#25991;&#20214;&#26159; /etc/openldap/slapd.conf&#12290;&#22312;&#36825;&#37324;&#65292;&#25105;&#20204;&#38656;&#35201;&#28155;&#21152;&#21644;&#20462;&#25913;&#19968;&#20123;&#20869;&#23481;&#65306;
</p><pre class="programlisting">
include         /etc/openldap/schema/core.schema

#
# &#28155;&#21152;&#20197;&#19979;&#20960;&#20010;&#24120;&#29992;&#30340; schema&#12290;
# schema &#25991;&#20214;&#26377;&#20381;&#36182;&#20851;&#31995;&#65292;&#25152;&#20197;&#20808;&#21518;&#39034;&#24207;&#38750;&#24120;&#37325;&#35201;&#12290;
#

include         /etc/openldap/schema/corba.schema
include         /etc/openldap/schema/cosine.schema
include         /etc/openldap/schema/inetorgperson.schema
include         /etc/openldap/schema/nis.schema

#
# &#21152;&#20837;&#19982; Postfix &#25972;&#21512;&#25152;&#38656;&#35201;&#30340; qmail.schema&#12290;
#

include         /etc/openldap/schema/qmail.schema

#
# &#27880;&#24847;&#65306;&#36825;&#37324;&#20462;&#25913;&#20102; PID &#25991;&#20214;&#23384;&#25918;&#30340;&#36335;&#24452;&#12290;
#

pidfile         /var/run/openldap/slapd.pid
argsfile        /var/run/openldap/slapd.args

#
# &#31105;&#27490;&#21311;&#21517;&#36830;&#25509;&#12290;
#

disallow    bind_anon

#
# Version of LDAP Protocol.
# OpenLDAP &#40664;&#35748;&#21482;&#20801;&#35768;&#20351;&#29992; LDAP &#21327;&#35758;&#30340;&#31532;&#19977;&#29256;&#26412;&#65288;LDAPv3&#65289;&#12290;
# &#22914;&#26524;&#38656;&#35201;&#24378;&#21046;&#20351;&#29992; LDAPv3&#65292;&#21017;&#21487;&#20197;&#20351;&#29992;&#20197;&#19979;&#21442;&#25968;&#65306;
#
#require        LDAPv3
#
# &#22914;&#26524;&#38656;&#35201;&#25552;&#20379; LDAPv2 &#30340;&#25903;&#25345;&#65292;&#38656;&#35201;&#21152;&#20837;&#20197;&#19979;&#21442;&#25968;&#65306;
#
allow           bind_v2

#
# &#26085;&#24535;&#32423;&#21035;&#65292;&#29992;&#20110;&#35843;&#35797;&#12290;&#36807;&#22810;&#30340;&#26085;&#24535;&#36755;&#20986;&#38656;&#35201;&#22823;&#37327;&#30340; I/O &#25805;&#20316;&#65292;&#21487;&#33021;&#20250;&#24433;&#21709;&#24615;&#33021;&#12290;
# &#19981;&#24314;&#35758;&#22312;&#23454;&#38469;&#29983;&#20135;&#26381;&#21153;&#22120;&#19978;&#20351;&#29992;&#36807;&#39640;&#30340;&#26085;&#24535;&#32423;&#21035;&#12290;
#
# &#20197;&#19979;&#26085;&#24535;&#32423;&#21035;&#23558;&#21482;&#35760;&#24405;&#36830;&#25509;(Conns)&#21644;&#26597;&#35810;(Filter)&#25805;&#20316;&#12290;
#loglevel   Conns Filter
#
# -1 &#32423;&#21035;&#23558;&#20135;&#29983;&#26368;&#22810;&#30340; debug &#20449;&#24687;&#12290;
#loglevel   -1
#
# 0 &#32423;&#21035;&#38500;&#20102;&#35760;&#24405; OpenLDAP &#21551;&#21160;&#26102;&#30340;&#36755;&#20986;&#20449;&#24687;&#22806;&#65292;&#19981;&#35760;&#24405;&#20219;&#20309;&#20449;&#24687;&#12290;
#loglevel    0

loglevel        256

#
# Access control policy.
#
# &#36825;&#37324;&#24320;&#22987;&#23450;&#20041;&#35775;&#38382;&#25511;&#21046;&#31574;&#30053;&#12290;

#
# &#36825;&#37324;&#26242;&#26102;&#36339;&#36807; ACL &#37096;&#20998;&#30340;&#37197;&#32622;&#12290;&#19979;&#25991;&#20013;&#23558;&#20250;&#21152;&#19978;&#12290;
#

#
# database &#20851;&#38190;&#23383;&#20043;&#21069;&#30340;&#21442;&#25968;&#37117;&#26159;&#20840;&#23616;&#21442;&#25968;&#12290;
# database &#20851;&#38190;&#23383;&#24320;&#22987;&#30340;&#22320;&#26041;&#34920;&#31034;&#24320;&#22987;&#23450;&#20041;&#19968;&#20010; LDAP Instance&#12290;
#

database       bdb

suffix          "dc=openbsdonly,dc=org"
rootdn          "cn=Manager,dc=openbsdonly,dc=org"
rootpw          123456

directory       /var/openldap-data/openbsdonly.org/
mode            0700

index           objectClass eq

#
# For mail attrs.
# &#20026;&#19968;&#20123; LDAP &#23646;&#24615;&#32500;&#25252;&#32034;&#24341;&#65292;&#21487;&#20197;&#21152;&#24555;&#26597;&#35810;&#36895;&#24230;&#12290;
#

index           description,o eq
index           mail,mailMessageStore,mailForwardingAddress,mailQuota,uid,cn eq
</pre><p>

            </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note: pidfile, argsfile"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">pidfile, argsfile</th></tr><tr><td align="left" valign="top"><p>
                    &#36825;&#37324;&#30340; pidfile &#21644; argsfile &#30340;&#36335;&#24452;&#37117;&#27809;&#26377;&#37319;&#29992;&#40664;&#35748;&#30340; /var/run/&#65292;&#22240;&#20026;&#25105;&#20204;&#23558;&#20197; _openldap:_openldap &#36825;&#20010;&#29992;&#25143;&#21644;&#29992;&#25143;&#32452;&#30340;&#36523;&#20221;&#26469;&#36816;&#34892; openldap &#26381;&#21153;&#65292;&#32780; /var/run/ &#30446;&#24405;&#30340;&#26435;&#38480;&#19981;&#20801;&#35768; _openldap &#29992;&#25143;&#21019;&#24314; pid &#25991;&#20214;&#65292;&#25152;&#20197;&#36825;&#37324;&#37319;&#29992;&#26032;&#24314; /var/run/openldap/ &#30446;&#24405;&#65292;&#24182;&#23558;&#35813;&#30446;&#24405;&#30340; owner &#35774;&#32622;&#20026; _openldap:_openldap &#30340;&#26041;&#24335;&#65292;&#20351;&#24471; _openldap &#29992;&#25143;&#33021;&#22815;&#23558; pid &#25991;&#20214;&#23384;&#25918;&#22312;&#36825;&#20010;&#30446;&#24405;&#19979;&#12290;
                </p></td></tr></table></div><p>

            </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip: OpenLDAP &#30340;&#26085;&#24535;"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">OpenLDAP &#30340;&#26085;&#24535;</th></tr><tr><td align="left" valign="top"><p>
                    OpenLDAP &#40664;&#35748;&#23558;&#25152;&#26377;&#26085;&#24535;&#20449;&#24687;&#21457;&#36865;&#21040; syslogd &#30340; 'local4' &#36825;&#20010;&#26085;&#24535;&#32423;&#21035;&#12290;&#25152;&#20197;&#65292;&#20026;&#20102;&#20415;&#20110;&#35843;&#35797;&#65292;&#21487;&#20197;&#23558;&#25152;&#26377;&#26085;&#24535;&#21333;&#29420;&#23384;&#25918;&#22312;&#26576;&#20010;&#26085;&#24535;&#25991;&#20214;&#37324;&#65292;&#27604;&#22914;&#65306;/var/log/openldap&#12290;&#20462;&#25913; /etc/syslog.conf&#65292;&#22686;&#21152;&#19968;&#34892;&#65306;

</p><pre class="programlisting">
local4.*                    /var/log/openldap
</pre><p>

&#20877;&#25163;&#21160;&#21019;&#24314; /var/log/openldap &#36825;&#20010;&#25991;&#20214;&#65292;&#24182;&#36890;&#30693; syslog &#31243;&#24207;&#37325;&#26032;&#35835;&#21462;&#37197;&#32622;&#25991;&#20214;&#65306;

</p><pre class="programlisting">
# touch /var/log/openldap
# chown _openldap:_openldap /var/log/openldap
# kill -HUP $(cat /var/run/syslog.pid)
</pre><p>

                </p></td></tr></table></div><p>

            </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note: database"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">database</th></tr><tr><td align="left" valign="top"><p>
                    database &#29992;&#20110;&#23450;&#20041; OpenLDAP &#20351;&#29992;&#21738;&#31181;&#25968;&#25454;&#24211;&#20316;&#20026; backend &#23384;&#20648;&#25968;&#25454;&#12290;&#20197;&#19979;&#20004;&#20010;&#29256;&#26412;&#25152;&#20351;&#29992;&#30340; backend &#26377;&#25152;&#19981;&#21516;&#65292;&#35831;&#26681;&#25454;&#33258;&#24049;&#30340;&#38656;&#35201;&#36827;&#34892;&#36873;&#25321;&#65306; 

                     </p><div class="itemizedlist"><ul type="disc"><li><p>openldap-server-2.3.33p1.tgz&#65306;&#21482;&#33021;&#20351;&#29992; ldbm &#20316;&#20026; backend&#12290;</p></li><li><p>openldap-server-2.3.33p1-bdb.tgz&#65306;&#21487;&#20197;&#20351;&#29992; bdb/ldbm &#20316;&#20026; backend&#12290;</p></li></ul></div><p>
                 </p></td></tr></table></div><p>

            </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note: suffix"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">suffix</th></tr><tr><td align="left" valign="top"><p>
                    &#36825;&#26159;&#23450;&#20041; LDAP &#26641;&#30340;&#21069;&#32512;&#12290; 

                    OpenLDAP &#25903;&#25345;&#22810;&#20010; suffix&#65292;&#36825;&#21487;&#20197;&#36890;&#36807;&#23450;&#20041;&#22810;&#20010; database &#26469;&#25351;&#23450;&#12290; 
                </p></td></tr></table></div><p>

            </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note: rootdn, passwd"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">rootdn, passwd</th></tr><tr><td align="left" valign="top"><p>
                    rootdn &#23450;&#20041;&#23450;&#20041;&#30340;&#26159;&#31649;&#29702;&#25972;&#20010; LDAP &#30340;&#31649;&#29702;&#21592;&#36134;&#21495;&#12290;rootpw &#21017;&#26159;&#35774;&#23450; rootdn &#30340;&#23494;&#30721;&#12290; 

                    </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip: &#23494;&#30721;"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">&#23494;&#30721;</th></tr><tr><td align="left" valign="top"><p>
                            &#36825;&#37324;&#30340; rootpw &#20351;&#29992;&#30340;&#26159;&#26126;&#25991;&#23494;&#30721;&#12290;&#20320;&#20063;&#21487;&#20197;&#20351;&#29992; slappasswd &#29983;&#25104;&#30340;&#23494;&#30721;&#65306;
</p><pre class="programlisting">
# slappasswd

New password: 
Re-enter new password:
{SSHA}mHzQL7t4YG/a6g5mt2YPLE/+ErmekI34
</pre><p>

&#40664;&#35748;&#26159;&#20351;&#29992; SSHA &#36825;&#20010;&#21152;&#23494;&#31639;&#27861;&#30340;&#12290;&#23558;&#24471;&#21040;&#30340; '{SSHA}mHzQL7t4YG/a6g5mt2YPLE/+ErmekI34' &#36825;&#19968;&#20018;&#23383;&#31526;&#22797;&#21046;&#21040; rootpw &#21518;&#38754;&#23601;&#21487;&#20197;&#20102;&#12290;
</p><pre class="programlisting">
passwd      {SSHA}mHzQL7t4YG/a6g5mt2YPLE/+ErmekI34
</pre><p>

&#20063;&#21487;&#20197;&#29992; -h &#21442;&#25968;&#25351;&#23450; slappasswd &#20351;&#29992;&#20854;&#23427;&#30340;&#21152;&#23494;&#31639;&#27861;&#12290;&#27604;&#22914;&#65306;
</p><pre class="programlisting">
# slappasswd -h {MD5}
</pre><p>
                        </p></td></tr></table></div><p>
                </p></td></tr></table></div><p>

            </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note: directory"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">directory</th></tr><tr><td align="left" valign="top"><p>
                        &#36825;&#26159;&#23450;&#20041; OpenLDAP &#30340;&#25968;&#25454;&#23384;&#25918;&#22312;&#21738;&#20010;&#30446;&#24405;&#19979;&#12290; 

&#21019;&#24314;&#30446;&#24405;&#24182;&#35774;&#32622;&#26435;&#38480;&#65306;

</p><pre class="programlisting">
# mkdir /var/run/openldap
# chown -R _openldap:_openldap /var/run/openldap

# mkdir /var/openldap-data/openbsdonly.org/
# chown -R _openldap:_openldap /var/openldap-data
# chmod -R 700 /var/openldap-data
</pre><p>

                </p></td></tr></table></div><p>
            </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="openldap_start"></a>6.3.3. &#21551;&#21160; OpenLDAP</h3></div></div></div><p>
                &#37117;&#37197;&#32622;&#22909;&#20102;&#65292;&#29616;&#22312;&#21487;&#20197;&#21551;&#21160; OpenLDAP &#20102;&#65306;
</p><pre class="programlisting">
# /usr/local/libexec/slapd -u _openldap -g _openldap -h ldap://127.0.0.1:389/
</pre><p>
            </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip: &#21442;&#25968;&#35299;&#37322;"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">&#21442;&#25968;&#35299;&#37322;</th></tr><tr><td align="left" valign="top"><p>
                    </p><div class="itemizedlist"><ul type="disc"><li><p>-u/-g&#65306;&#20197;&#21738;&#20010;&#29992;&#25143;&#30340;&#36523;&#20221;&#25191;&#34892; slapd daemon&#12290;</p></li><li><p>-h&#65306;&#30417;&#21548;&#21738;&#20010; IP &#30340;&#21738;&#20010;&#31471;&#21475;&#12290;</p></li></ul></div><p>
                </p></td></tr></table></div><p>

            &#36825;&#26102;&#20505;&#22312; /var/log/openldap &#37324;&#24212;&#35813;&#24050;&#32463;&#26377;&#19968;&#20123;&#20449;&#24687;&#20102;&#65292;&#19981;&#22952;&#29616;&#22312;&#26597;&#30475;&#19968;&#19979;&#65306;
</p><pre class="programlisting">
# tail /var/log/openldap

Sep 20 22:07:00 mail slapd[5496]: @(#) $OpenLDAP: slapd 2.3.33 (Mar  6 2007 20:51:09) $
@i386.ports.openbsd.org:/usr/obj/i386/openldap-2.3.33-bdb/build-i386-bdb/servers/slapd 
Sep 20 22:07:01 mail slapd[5496]: WARNING: No dynamic config support for database ldbm. 
Sep 20 22:07:01 mail slapd[5496]: slapd starting
</pre><p>

&#22914;&#26524;&#30475;&#21040;&#26377;&#31867;&#20284;&#30340;&#36755;&#20986;&#65292;&#21017;&#34920;&#31034;&#24050;&#32463;&#27491;&#24120;&#36816;&#34892;&#20102;&#12290; 

            </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="openldap_initialize"></a>6.3.4. &#21021;&#22987;&#21270; LDAP</h3></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="openldap_ldap_tree"></a>6.3.4.1. LDAP &#26641;&#32467;&#26500;</h4></div></div></div><p></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="openldap_ldap_root_entry"></a>6.3.4.2. root entry: dc=openbsdonly,dc=org</h4></div></div></div><p></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="openldap_ldap_domains"></a>6.3.4.3. o=domains,dc=openbsdonly,dc=org</h4></div></div></div><p></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="openldap_ldap_vmail"></a>6.3.4.4. cn=vmail/vmailadmin,dc=openbsdonly,dc=org</h4></div></div></div><p></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="openldap_ldap_domainX"></a>6.3.4.5. o=domainX.com,o=domains,dc=openbsdonly,dc=org</h4></div></div></div><p></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="openldap_ldap_mail_www"></a>6.3.4.6. mail=www@openbsdonly.org,o=openbsdonly.org,o=domains,dc=openbsdonly,dc=org</h4></div></div></div><p></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="openldap_ldap_mail_admin"></a>6.3.4.7. mail=admin@openbsdonly.org,o=openbsdonly.org,o=domains,dc=openbsdonly,dc=org</h4></div></div></div><p></p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="id1181386"></a>6.3.5. &#26597;&#30475;&#25968;&#25454;&#24211;&#30340;&#29366;&#24577;</h3></div></div></div><p></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="id1181393"></a>6.3.6. ACL(Access Control List)</h3></div></div></div><p></p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="openldap_installation.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="openldap.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="openldap_rc_conf_local.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">6.2. &#23433;&#35013; OpenLDAP </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 6.4. /etc/rc.conf.local</td></tr></table></div></body></html>
